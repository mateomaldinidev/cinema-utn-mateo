<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/models/usuarios/Usuario.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/models/usuarios/Usuario.java" />
              <option name="originalContent" value="package com.grupo2.cinemautn.models.usuarios;&#10;&#10;import com.grupo2.cinemautn.models.contenido.Contenido;&#10;import com.grupo2.cinemautn.models.contenido.Calificacion;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Objects;&#10;&#10;public class Usuario {&#10;    //atributos&#10;    private static int contador = 0;&#10;    private int idUsuario;&#10;    private String nombre;&#10;    private String email;&#10;    private String contrasena;&#10;    private boolean estado;&#10;    private Rol rol;&#10;    private ListaFavoritos listaFavoritos;&#10;&#10;    //constructor&#10;    public Usuario(String nombre, String email, String contrasena, Rol rol) {&#10;        contador ++;&#10;        this.idUsuario = contador;&#10;        this.nombre = nombre;&#10;        this.email = email;&#10;        this.contrasena = contrasena;&#10;        this.estado = true; //activo por defecto&#10;        this.rol = rol;&#10;        this.listaFavoritos = new ListaFavoritos();&#10;    }&#10;&#10;    public Usuario() {&#10;        contador ++;&#10;        this.idUsuario = contador;&#10;        this.estado = true; //activo por defecto&#10;        listaFavoritos = new ListaFavoritos();&#10;    }&#10;&#10;    //getters y setters&#10;&#10;    public int getIdUsuario() {&#10;        return idUsuario;&#10;    }&#10;&#10;    public String getNombre() {&#10;        return nombre;&#10;    }&#10;&#10;    public void setNombre(String nombre) {&#10;        this.nombre = nombre;&#10;    }&#10;&#10;    public String getEmail() {&#10;        return email;&#10;    }&#10;&#10;    public void setEmail(String email) {&#10;        this.email = email;&#10;    }&#10;&#10;    public String getContrasena() {&#10;        return contrasena;&#10;    }&#10;&#10;    public void setContrasena(String contrasena) {&#10;        this.contrasena = contrasena;&#10;    }&#10;&#10;    public boolean isEstado() {&#10;        return estado;&#10;    }&#10;&#10;    public void setEstado(boolean estado) {&#10;        this.estado = estado;&#10;    }&#10;&#10;    public Rol getRol() {&#10;        return rol;&#10;    }&#10;&#10;    public void setRol(Rol rol) {&#10;        this.rol = rol;&#10;    }&#10;&#10;    public ListaFavoritos getListaFavoritos() {&#10;        return listaFavoritos;&#10;    }&#10;&#10;    public void setListaFavoritos(ListaFavoritos listaFavoritos) {&#10;        this.listaFavoritos = listaFavoritos;&#10;    }&#10;&#10;    //otros métodos&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;Usuario{&quot; +&#10;                &quot;idUsuario=&quot; + idUsuario +&#10;                &quot;, nombre='&quot; + nombre + '\'' +&#10;                &quot;, email='&quot; + email + '\'' +&#10;                &quot;, contrasena='&quot; + contrasena + '\'' +&#10;                &quot;, estado=&quot; + estado +&#10;                &quot;, rol=&quot; + rol +&#10;                &quot;, listaFavoritos=&quot; + listaFavoritos +&#10;                '}';&#10;    }&#10;&#10;    @Override&#10;    public boolean equals(Object o) {&#10;        if (o == null || getClass() != o.getClass()) return false;&#10;        Usuario usuario = (Usuario) o;&#10;        return Objects.equals(email, usuario.email);&#10;    }&#10;&#10;    @Override&#10;    public int hashCode() {&#10;        return Objects.hashCode(email);&#10;    }&#10;&#10;    public void agregarAFavoritos(Contenido contenido) {&#10;        if (contenido == null) return;&#10;        if (this.listaFavoritos == null) this.listaFavoritos = new ListaFavoritos();&#10;        this.listaFavoritos.agregarFavorito(contenido);&#10;    }&#10;&#10;    public void eliminarDeFavoritos(Contenido contenido) {&#10;        if (contenido == null || this.listaFavoritos == null) return;&#10;        this.listaFavoritos.eliminarFavorito(contenido);&#10;    }&#10;&#10;    public List&lt;Contenido&gt; verFavoritos() {&#10;        if (this.listaFavoritos == null) return new ArrayList&lt;&gt;();&#10;        return new ArrayList&lt;&gt;(this.listaFavoritos.getFavoritos());&#10;    }&#10;&#10;    public String verContenido(Contenido contenido) {&#10;        if (contenido == null) return &quot;Contenido no disponible&quot;;&#10;        return contenido.toString();&#10;    }&#10;&#10;    public void calificar(Contenido contenido, double estrellas) {&#10;        if (contenido == null) return;&#10;        // Crear una calificación temporal con ids por defecto (0)&#10;        Calificacion c = new Calificacion(0, this.idUsuario, contenido.getId(), estrellas, true);&#10;        contenido.agregarCalificacion(c);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.grupo2.cinemautn.models.usuarios;&#10;&#10;import com.grupo2.cinemautn.models.contenido.Contenido;&#10;import com.grupo2.cinemautn.models.contenido.Calificacion;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Objects;&#10;&#10;public class Usuario {&#10;    //atributos&#10;    private static int contador = 0;&#10;    private int idUsuario;&#10;    private String nombre;&#10;    private String email;&#10;    private String contrasena;&#10;    private boolean estado;&#10;    private Rol rol;&#10;    private ListaFavoritos listaFavoritos;&#10;&#10;    //constructor&#10;    public Usuario(String nombre, String email, String contrasena, Rol rol) {&#10;        contador ++;&#10;        this.idUsuario = contador;&#10;        this.nombre = nombre;&#10;        this.email = email;&#10;        this.contrasena = contrasena;&#10;        this.estado = true; //activo por defecto&#10;        this.rol = rol;&#10;        this.listaFavoritos = new ListaFavoritos();&#10;    }&#10;&#10;    public Usuario() {&#10;        contador ++;&#10;        this.idUsuario = contador;&#10;        this.estado = true; //activo por defecto&#10;        listaFavoritos = new ListaFavoritos();&#10;    }&#10;&#10;    //getters y setters&#10;&#10;    public int getIdUsuario() {&#10;        return idUsuario;&#10;    }&#10;&#10;    public String getNombre() {&#10;        return nombre;&#10;    }&#10;&#10;    public void setNombre(String nombre) {&#10;        this.nombre = nombre;&#10;    }&#10;&#10;    public String getEmail() {&#10;        return email;&#10;    }&#10;&#10;    public void setEmail(String email) {&#10;        this.email = email;&#10;    }&#10;&#10;    public String getContrasena() {&#10;        return contrasena;&#10;    }&#10;&#10;    public void setContrasena(String contrasena) {&#10;        this.contrasena = contrasena;&#10;    }&#10;&#10;    public boolean isEstado() {&#10;        return estado;&#10;    }&#10;&#10;    public void setEstado(boolean estado) {&#10;        this.estado = estado;&#10;    }&#10;&#10;    public Rol getRol() {&#10;        return rol;&#10;    }&#10;&#10;    public void setRol(Rol rol) {&#10;        this.rol = rol;&#10;    }&#10;&#10;    public ListaFavoritos getListaFavoritos() {&#10;        return listaFavoritos;&#10;    }&#10;&#10;    public void setListaFavoritos(ListaFavoritos listaFavoritos) {&#10;        this.listaFavoritos = listaFavoritos;&#10;    }&#10;&#10;    public void setIdUsuario(int id) {&#10;        this.idUsuario = id;&#10;        if (id &gt; contador) contador = id;&#10;    }&#10;&#10;    //otros métodos&#10;&#10;    @Override&#10;    public String toString() {&#10;        return &quot;Usuario{&quot; +&#10;                &quot;idUsuario=&quot; + idUsuario +&#10;                &quot;, nombre='&quot; + nombre + '\'' +&#10;                &quot;, email='&quot; + email + '\'' +&#10;                &quot;, contrasena='&quot; + contrasena + '\'' +&#10;                &quot;, estado=&quot; + estado +&#10;                &quot;, rol=&quot; + rol +&#10;                &quot;, listaFavoritos=&quot; + listaFavoritos +&#10;                '}';&#10;    }&#10;&#10;    @Override&#10;    public boolean equals(Object o) {&#10;        if (o == null || getClass() != o.getClass()) return false;&#10;        Usuario usuario = (Usuario) o;&#10;        return Objects.equals(email, usuario.email);&#10;    }&#10;&#10;    @Override&#10;    public int hashCode() {&#10;        return Objects.hashCode(email);&#10;    }&#10;&#10;    public void agregarAFavoritos(Contenido contenido) {&#10;        if (contenido == null) return;&#10;        if (this.listaFavoritos == null) this.listaFavoritos = new ListaFavoritos();&#10;        this.listaFavoritos.agregarFavorito(contenido);&#10;    }&#10;&#10;    public void eliminarDeFavoritos(Contenido contenido) {&#10;        if (contenido == null || this.listaFavoritos == null) return;&#10;        this.listaFavoritos.eliminarFavorito(contenido);&#10;    }&#10;&#10;    public List&lt;Contenido&gt; verFavoritos() {&#10;        if (this.listaFavoritos == null) return new ArrayList&lt;&gt;();&#10;        return new ArrayList&lt;&gt;(this.listaFavoritos.getFavoritos());&#10;    }&#10;&#10;    public String verContenido(Contenido contenido) {&#10;        if (contenido == null) return &quot;Contenido no disponible&quot;;&#10;        return contenido.toString();&#10;    }&#10;&#10;    public void calificar(Contenido contenido, double estrellas) {&#10;        if (contenido == null) return;&#10;        // Crear una calificación temporal con ids por defecto (0)&#10;        Calificacion c = new Calificacion(0, this.idUsuario, contenido.getId(), estrellas, true);&#10;        contenido.agregarCalificacion(c);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/persistence/GestoraUsuariosJSON.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/persistence/GestoraUsuariosJSON.java" />
              <option name="originalContent" value="package com.grupo2.cinemautn.persistence;&#10;import com.grupo2.cinemautn.models.usuarios.Usuario;&#10;&#10;import org.json.JSONArray;&#10;import org.json.JSONException;&#10;import org.json.JSONObject;&#10;import org.json.JSONTokener;&#10;import java.util.ArrayList;&#10;&#10;public class GestoraUsuariosJSON {&#10;&#10;    //  SERIALIZAR&#10;    public void listaToArchivo(ArrayList&lt;Usuario&gt; lista, String nombreArchivo) {&#10;        OperacionesLectoEscritura.grabar (nombreArchivo, serializarLista(lista));&#10;&#10;    }&#10;&#10;    public JSONObject serializar(Usuario u) {&#10;        JSONObject jsonObject = null;&#10;        try {&#10;            jsonObject = new JSONObject();&#10;            //TODO: completar con los atributos de Usuario&#10;            //jsonObject.put(&quot;nombre&quot;, u.getNombre());&#10;            //jsonObject.put(&quot;edad&quot;, u.getEdad());&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return jsonObject;&#10;    }&#10;&#10;&#10;    public JSONArray serializarLista(ArrayList&lt;Usuario&gt; lista) {&#10;        JSONArray jsonArray = null;&#10;        try {&#10;            jsonArray = new JSONArray();&#10;            for (Usuario u: lista) {&#10;                jsonArray.put(serializar(u)); // agrega el JSONObject al JSONArray&#10;            }&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return jsonArray;&#10;    }&#10;&#10;    // DESERIALIZAR&#10;&#10;    public ArrayList&lt;Usuario&gt; archivoALista(String nombreArchivo) {&#10;        JSONTokener tokener = OperacionesLectoEscritura.leer(nombreArchivo);&#10;        ArrayList&lt;Usuario&gt; lista = null;&#10;        try {&#10;            lista = deserializarLista(new JSONArray(tokener));&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return lista;&#10;    }&#10;&#10;    public Usuario deserializar (JSONObject jsonObject) {&#10;        Usuario u = new Usuario();&#10;        try {&#10;            // TODO: completar con los atributos de Usuario&#10;            //u.setNombre(jsonObject.getString(&quot;nombre&quot;));&#10;            //u.setEdad(jsonObject.getInt(&quot;edad&quot;));&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return u;&#10;    }&#10;&#10;    public ArrayList&lt;Usuario&gt; deserializarLista (JSONArray jsonArray) {&#10;        ArrayList&lt;Usuario&gt; lista = new ArrayList&lt;&gt;();&#10;        try {&#10;            for (int i = 0; i &lt; jsonArray.length(); i++) {&#10;                Usuario u = deserializar(jsonArray.getJSONObject(i));&#10;                lista.add(u);&#10;            }&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return lista;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.grupo2.cinemautn.persistence;&#10;import com.grupo2.cinemautn.models.usuarios.Usuario;&#10;import com.grupo2.cinemautn.models.usuarios.Rol;&#10;&#10;import org.json.JSONArray;&#10;import org.json.JSONException;&#10;import org.json.JSONObject;&#10;import org.json.JSONTokener;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class GestoraUsuariosJSON {&#10;&#10;    private static final String DEFAULT_FILE = &quot;usuarios.json&quot;;&#10;&#10;    //  SERIALIZAR&#10;    public void listaToArchivo(ArrayList&lt;Usuario&gt; lista, String nombreArchivo) {&#10;        OperacionesLectoEscritura.grabar (nombreArchivo, serializarLista(lista));&#10;&#10;    }&#10;&#10;    public JSONObject serializar(Usuario u) {&#10;        JSONObject jsonObject = null;&#10;        try {&#10;            jsonObject = new JSONObject();&#10;            jsonObject.put(&quot;id&quot;, u.getIdUsuario());&#10;            jsonObject.put(&quot;nombre&quot;, u.getNombre());&#10;            jsonObject.put(&quot;correo&quot;, u.getEmail());&#10;            jsonObject.put(&quot;contrasena&quot;, u.getContrasena());&#10;            jsonObject.put(&quot;estado&quot;, u.isEstado());&#10;            jsonObject.put(&quot;rol&quot;, u.getRol() != null ? u.getRol().name() : JSONObject.NULL);&#10;&#10;            // favoritos: lista de ids (si hay)&#10;            JSONArray favArray = new JSONArray();&#10;            if (u.getListaFavoritos() != null &amp;&amp; u.getListaFavoritos().getFavoritos() != null) {&#10;                for (var c : u.getListaFavoritos().getFavoritos()) {&#10;                    favArray.put(c.getId());&#10;                }&#10;            }&#10;            jsonObject.put(&quot;favoritos&quot;, favArray);&#10;&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return jsonObject;&#10;    }&#10;&#10;&#10;    public JSONArray serializarLista(ArrayList&lt;Usuario&gt; lista) {&#10;        JSONArray jsonArray = null;&#10;        try {&#10;            jsonArray = new JSONArray();&#10;            for (Usuario u: lista) {&#10;                jsonArray.put(serializar(u)); // agrega el JSONObject al JSONArray&#10;            }&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;        return jsonArray;&#10;    }&#10;&#10;    // DESERIALIZAR&#10;&#10;    public ArrayList&lt;Usuario&gt; archivoALista(String nombreArchivo) {&#10;        JSONTokener tokener = OperacionesLectoEscritura.leer(nombreArchivo);&#10;        ArrayList&lt;Usuario&gt; lista = new ArrayList&lt;&gt;();&#10;        try {&#10;            if (tokener == null) return lista;&#10;            lista = deserializarLista(new JSONArray(tokener));&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return lista;&#10;    }&#10;&#10;    public Usuario deserializar (JSONObject jsonObject) {&#10;        Usuario u = new Usuario();&#10;        try {&#10;            if (jsonObject.has(&quot;id&quot;)) u.setIdUsuario(jsonObject.getInt(&quot;id&quot;));&#10;            if (jsonObject.has(&quot;nombre&quot;)) u.setNombre(jsonObject.getString(&quot;nombre&quot;));&#10;            if (jsonObject.has(&quot;correo&quot;)) u.setEmail(jsonObject.getString(&quot;correo&quot;));&#10;            if (jsonObject.has(&quot;contrasena&quot;)) u.setContrasena(jsonObject.getString(&quot;contrasena&quot;));&#10;            if (jsonObject.has(&quot;estado&quot;)) u.setEstado(jsonObject.getBoolean(&quot;estado&quot;));&#10;            if (jsonObject.has(&quot;rol&quot;) &amp;&amp; !jsonObject.isNull(&quot;rol&quot;)) {&#10;                try {&#10;                    u.setRol(Rol.valueOf(jsonObject.getString(&quot;rol&quot;)));&#10;                } catch (IllegalArgumentException ignored) {}&#10;            }&#10;&#10;            // favoritos: lista de ids (deserializamos como vacío; necesitará resolución externa a objetos Contenido)&#10;            if (jsonObject.has(&quot;favoritos&quot;)) {&#10;                // dejamos la lista vacía; la resolución a objetos Contenido puede hacerse desde UsuarioService si se dispone de ContenidoService&#10;            }&#10;&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return u;&#10;    }&#10;&#10;    public ArrayList&lt;Usuario&gt; deserializarLista (JSONArray jsonArray) {&#10;        ArrayList&lt;Usuario&gt; lista = new ArrayList&lt;&gt;();&#10;        try {&#10;            for (int i = 0; i &lt; jsonArray.length(); i++) {&#10;                Usuario u = deserializar(jsonArray.getJSONObject(i));&#10;                lista.add(u);&#10;            }&#10;        } catch (JSONException e) {&#10;            e.printStackTrace();&#10;        }&#10;&#10;        return lista;&#10;    }&#10;&#10;    // util: cargar desde default&#10;    public ArrayList&lt;Usuario&gt; cargarPorDefecto() {&#10;        return archivoALista(DEFAULT_FILE);&#10;    }&#10;&#10;    public void guardarPorDefecto(List&lt;Usuario&gt; lista) {&#10;        listaToArchivo(new ArrayList&lt;&gt;(lista), DEFAULT_FILE);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/service/UsuarioService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/grupo2/cinemautn/service/UsuarioService.java" />
              <option name="originalContent" value="package com.grupo2.cinemautn.service;&#10;&#10;import com.grupo2.cinemautn.interfaces.IGestionable;&#10;import com.grupo2.cinemautn.models.usuarios.Usuario;&#10;&#10;import java.util.*;&#10;import java.util.stream.Collectors;&#10;&#10;public class UsuarioService implements IGestionable&lt;Usuario&gt; {&#10;    private Set&lt;Usuario&gt; usuarios = new HashSet&lt;&gt;();&#10;&#10;    @Override&#10;    public void crear(Usuario u) {&#10;        if (u == null) return;&#10;        usuarios.add(u);&#10;    }&#10;&#10;    @Override&#10;    public Usuario leer(int id) {&#10;        for (Usuario u : usuarios) {&#10;            if (u.getIdUsuario() == id) return u;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void actualizar(Usuario u) {&#10;        if (u == null) return;&#10;        Usuario existente = leer(u.getIdUsuario());&#10;        if (existente != null) {&#10;            usuarios.remove(existente);&#10;            usuarios.add(u);&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void eliminar(int id) {&#10;        Usuario u = leer(id);&#10;        if (u != null) usuarios.remove(u);&#10;    }&#10;&#10;    @Override&#10;    public List&lt;Usuario&gt; listar() {&#10;        return new ArrayList&lt;&gt;(usuarios);&#10;    }&#10;&#10;    public Usuario buscarPorCorreo(String correo) {&#10;        if (correo == null) return null;&#10;        for (Usuario u : usuarios) {&#10;            if (correo.equalsIgnoreCase(u.getEmail())) return u;&#10;        }&#10;        return null;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.grupo2.cinemautn.service;&#10;&#10;import com.grupo2.cinemautn.interfaces.IGestionable;&#10;import com.grupo2.cinemautn.models.usuarios.Usuario;&#10;import com.grupo2.cinemautn.persistence.GestoraUsuariosJSON;&#10;&#10;import java.util.*;&#10;&#10;public class UsuarioService implements IGestionable&lt;Usuario&gt; {&#10;    private Set&lt;Usuario&gt; usuarios = new HashSet&lt;&gt;();&#10;    private GestoraUsuariosJSON gestora = new GestoraUsuariosJSON();&#10;&#10;    public UsuarioService() {&#10;        // cargar desde archivo si existe&#10;        List&lt;Usuario&gt; lista = gestora.cargarPorDefecto();&#10;        if (lista != null) {&#10;            usuarios.addAll(lista);&#10;        }&#10;    }&#10;&#10;    private void persistir() {&#10;        // convertir set a ArrayList para la gestora&#10;        gestora.guardarPorDefecto(new ArrayList&lt;&gt;(usuarios));&#10;    }&#10;&#10;    @Override&#10;    public void crear(Usuario u) {&#10;        if (u == null) return;&#10;        usuarios.add(u);&#10;        persistir();&#10;    }&#10;&#10;    @Override&#10;    public Usuario leer(int id) {&#10;        for (Usuario u : usuarios) {&#10;            if (u.getIdUsuario() == id) return u;&#10;        }&#10;        return null;&#10;    }&#10;&#10;    @Override&#10;    public void actualizar(Usuario u) {&#10;        if (u == null) return;&#10;        Usuario existente = leer(u.getIdUsuario());&#10;        if (existente != null) {&#10;            usuarios.remove(existente);&#10;            usuarios.add(u);&#10;            persistir();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void eliminar(int id) {&#10;        Usuario u = leer(id);&#10;        if (u != null) {&#10;            usuarios.remove(u);&#10;            persistir();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public List&lt;Usuario&gt; listar() {&#10;        return new ArrayList&lt;&gt;(usuarios);&#10;    }&#10;&#10;    public Usuario buscarPorCorreo(String correo) {&#10;        if (correo == null) return null;&#10;        for (Usuario u : usuarios) {&#10;            if (correo.equalsIgnoreCase(u.getEmail())) return u;&#10;        }&#10;        return null;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>